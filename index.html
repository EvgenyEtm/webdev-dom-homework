<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments">

      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          style="white-space:pre-line"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>
<style>
  .red {
    background-color: red;
  }

  .unactive{
    background-color: #9e9e9e;
  }
  .newNew{
    background-color: green;
  }
</style>
  <script>
    "use strict";
// Код писать здесь
const text = document.querySelector('.add-form-text');
const name = document.querySelector('.add-form-name');
const boxMessages = document.querySelector('.comments');
const button = document.querySelector('.add-form-button');
const del = document.querySelectorAll('ul > li');
const date = new Date();
button.disabled = true;
button.classList.add('unactive');
// const UlComments = document.getElementById('comments')
// console.log(UlComments);

//console.log(boxMessages);

text.addEventListener("input", () => {
  button.disabled = false;
  button.classList.remove('unactive');
}); 
name.addEventListener("input", () => {
  button.disabled = false;
  button.classList.remove('unactive');
}); 



text.addEventListener("keyup", keyCode);

function keyCode(e) {
if (e.keyCode === 13) {
    addCommentare();
} else {
  return;
}
}



const comments = [
  {
    name: 'Глеб Фокин',
    text: 'Это будет первый комментарий на этой странице ',
    time: '12.02.22 12:18',
    like: 3,
    isLiked: false,
    isEdit: false,
  },
  {
    name: 'Варвара Н.',
    text: 'Мне нравится как оформлена эта страница! ❤',
    time: '13.02.22 19:22',
    like: 75,
    isLiked: true,
    isEdit: false,
  },
  
];




const likedFunction = () => {
  const likeButtons = document.querySelectorAll('.like-button');
  // console.log(likeButtons);
  for (const likeButton of likeButtons) {
    likeButton.addEventListener('click', () => {
      const index = likeButton.dataset.index
      //console.log();
      if (comments[index].isLiked === true) {
        comments[index].like--;
        comments[index].isLiked = false;
      } else if(comments[index].isLiked === false) {
        comments[index].like++;
        comments[index].isLiked = true;
      }
      renderFunction();
    })
    
  }
}
// const editText = () => {
//   const newTexts = document.querySelectorAll('.edit-text');
//   for (const newText of newTexts) {
//     const index = newText.dataset.index;
//     console.log(newText.value);
//   }

// }

const editButton = () => {

  const editButtons = document.querySelectorAll('.edit-button');

  for (const editButton of editButtons) {
editButton.addEventListener('click', (event) => {
  event.stopPropagation();
  const index = editButton.dataset.index; 
  //console.log(comments[edit].isEdit);
    if (comments[index].isEdit === true) {
      const newTexts = document.querySelectorAll('.edit-text');
      for (const newText of newTexts) {
       comments[index].text = newText.value;
       comments[index].isEdit = false;
        }
    } else if (comments[index].isEdit === false) {
      comments[index].isEdit = true;
      //console.log(comments[index].isEdit);
    }
    renderFunction();


})
  }
}

const colorClass = () => {
  const bgcWhite = document.querySelectorAll('.quote');
  for (const bgcWhit of bgcWhite) {
    //console.log(bgcWhit);
  }
}
//Start_any End_any
const answerElement = () => {
  const answerTexts = document.querySelectorAll('.comment-text');
  //console.log(answerTexts);
  for( const answerText of answerTexts)
  answerText.addEventListener('click', (event) => {
    event.stopPropagation();
    const index = answerText.dataset.index; 
      //console.log(answerText.dataset.index);
      text.value = `BEGIN_QUOTE > ${comments[index].name} \n  ${comments[index].text} QUOTE_END \n`;

      renderFunction();

  })
}

const renderFunction = () => {
  const commtentsHtml = comments
  .map((comment, index, edit) => {
    return `<li class="comment">
          <div class="comment-header">
            <div>${comment.name}</div>
            <div>${comment.time}</div>
          </div>
          <div class='quote'>
            <div class="comment-body">
            ${comment.isEdit? `<textarea data-index="${index}" class="edit-text white-space: pre-line">${comment.text}</textarea>` : `<div data-index="${index}" class="comment-text" style="white-space:pre-line">${comment.text}</div>`}
          </div>
            </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">${comment.like}</span>
              <button data-index="${index}" class="${comment.isLiked ? 'like-button -active-like' : 'like-button'}"></button>
            </div>
            
          </div>
          <button data-index="${index}" class="edit-button">${comment.isEdit? 'Сохранить' : 'Редактировать'}</button>
        </li>`
  }

  ).join("");
  boxMessages.innerHTML = commtentsHtml;
  likedFunction();
  editButton();
  answerElement();
  colorClass();
};
renderFunction();





function formatDate(date) {

let dd = date.getDate();
if (dd < 10) dd = '0' + dd;

let mm = date.getMonth() + 1;
if (mm < 10) mm = '0' + mm;

let yy = date.getFullYear() % 100;
if (yy < 10) yy = '0' + yy;

let hh = date.getHours();
if (hh < 10) hh = '0' + hh;

let min = date.getMinutes();
if (min < 10) min = '0' + min;

return dd + '.' + mm + '.' + yy + ' ' + hh + ':' + min;
}



 let n = 0;


button.addEventListener("click", () => {
  addCommentare();
});


function addCommentare() {

  text.classList.remove('red');
  name.classList.remove('red');
  if(name.value === '' && text.value === '') {
    text.placeholder = 'Это поле не должно быть пустым'
    text.classList.add('red');
    name.placeholder = 'Это поле не должно быть пустым'
    name.classList.add('red');
    return;
  }
  else if (name.value === '') {
    name.placeholder = 'Это поле не должно быть пустым'
    name.classList.add('red');
    return;
  } else if (text.value === ''){
    text.placeholder = 'Это поле не должно быть пустым'
    text.classList.add('red');
    return;
  }
  button.disabled = true;
  button.classList.add('unactive');

comments.push({
    name: name.value
    .replaceAll("&", "&amp")
    .replaceAll("<", "&lt")
    .replaceAll(">", "&gt")
    .replaceAll('"', "&quot"),
    text: text.value    
    .replaceAll("&", "&amp")
    .replaceAll("<", "&lt")
    .replaceAll(">", "&gt")
    .replaceAll('"', "&quot")
    .replaceAll("BEGIN_QUOTE", "<div class='quoteOne'>")
    .replaceAll("QUOTE_END", "</div>"),
    time: formatDate(date),
    like: 0,
    isLiked: false,
    isEdit: false,
});

  name.value = '';
  text.value = '';

  renderFunction();
  
}




    //console.log("It works!");
  </script>
</html>